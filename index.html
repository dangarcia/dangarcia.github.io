<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      #white-layer {
        position: absolute;
        top: 0;
        left: 0;
        background-color: white;
        width: 100%;
        height: 100%;
        z-index: 1;
      }

      #hidden-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 2;
        opacity: 0;
        transition: opacity 1s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div id="white-layer"></div>
    <img id="hidden-image" src="https://picsum.photos/id/237/800/800" />
    <script>
      const whiteLayer = document.querySelector("#white-layer");
      const hiddenImage = document.querySelector("#hidden-image");
      const mousePos = { x: 0, y: 0 };
      const brushSize = 30;

      whiteLayer.addEventListener("mousedown", function (e) {
        e.preventDefault();
        mousePos.x = e.clientX;
        mousePos.y = e.clientY;
        whiteLayer.style.clipPath = `circle(${brushSize / 2}px at ${mousePos.x}px ${mousePos.y}px)`;
        whiteLayer.addEventListener("mousemove", scratchOff);
      });

      whiteLayer.addEventListener("mouseup", function (e) {
        whiteLayer.removeEventListener("mousemove", scratchOff);
      });

      function scratchOff(e) {
        const dx = e.clientX - mousePos.x;
        const dy = e.clientY - mousePos.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < brushSize) {
          const opacity = (brushSize - distance) / brushSize;
          const x = e.clientX - brushSize / 2;
          const y = e.clientY - brushSize / 2;

          whiteLayer.style.clipPath = `circle(${brushSize / 2}px at ${x}px ${y}px)`;
          hiddenImage.style.opacity = 1 - opacity;
        }

        mousePos.x = e.clientX;
        mousePos.y = e.clientY;
      }
    </script>
  </body>
</html>
